name: Test Miniconda Environment Setup

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # Allow manual triggering

jobs:
  test-windows:
    runs-on: windows-latest
    timeout-minutes: 15  # Increased timeout
    steps:
      - uses: actions/checkout@v3
      
      - name: Run Windows Setup Script
        shell: cmd
        run: setup_and_run.bat simple
        
      - name: Verify Python Environment
        shell: cmd
        run: |
          call %USERPROFILE%\miniconda3\Scripts\activate.bat py311
          python -c "import sys; print(f'Python {sys.version}')"
          python -c "import numpy; print(f'NumPy {numpy.__version__}')"
          python -c "import pandas; print(f'Pandas {pandas.__version__}')"
          python -c "import matplotlib; print(f'Matplotlib {matplotlib.__version__}')"

  test-macos:
    # GitHub Actions doesn't have Apple Silicon runners yet,
    # but we can still test the script's architecture detection logic
    runs-on: ${{matrix.os}}
    timeout-minutes: 15  # Increased timeout

    strategy:
      fail-fast: false
      matrix:
        os: [macos-latest, macos-13]

    steps:
      - uses: actions/checkout@v3
      
      - name: Make Script Executable
        run: chmod +x setup_and_run.sh
        
      - name: Run macOS Setup Script
        run: ./setup_and_run.sh simple
        
      - name: Verify Python Environment
        run: |
          source $HOME/miniconda3/bin/activate py311
          python -c "import sys; print(f'Python {sys.version}')"
          python -c "import numpy; print(f'NumPy {numpy.__version__}')"
          python -c "import pandas; print(f'Pandas {pandas.__version__}')"
          python -c "import matplotlib; print(f'Matplotlib {matplotlib.__version__}')"